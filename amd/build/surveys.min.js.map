{"version":3,"file":"surveys.min.js","sources":["../src/surveys.js"],"names":["define","$","Ajax","Notification","init","this","loadSurveys","contentDiv","call","methodname","args","done","response","success","html","message","surveys","length","M","util","get_string","console","group","log","forEach","survey","index","icon","completed","extraText","attributes","join","surveyId","Object","keys","responses","url","title","responseid","groupEnd","view-responses","on","e","preventDefault","data","responsesDiv","is","slideUp","text","responsesHtml","key","hasOwnProperty","slideDown","fail","error","exception"],"mappings":"AAoBAA,OAAO,CAAC,SAAU,YAAa,oBAAqB,SAASC,EAAGC,EAAMC,GACpE,MAAO,CACHC,KAAM,WACFC,KAAKC,cAETA,YAAa,WACT,IAAIC,EAAaN,EAAE,uBAEnBC,EAAKM,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,KACP,GAAGC,KAAK,SAASC,GACjB,IAAKA,EAASC,QACV,OAAON,EAAWO,KAAK,0CAA4CF,EAASG,QAAU,UAG1F,GAA0B,IAAtBH,EAASI,QAAQC,OACjB,OAAOV,EAAWO,KAAK,KAAOI,EAAEC,KAAKC,WAAW,YAAa,qBAAuB,QAGxFC,QAAQC,MAAM,sCACdD,QAAQE,IAAI,gBAAiBX,EAASI,QAAQC,QAE9C,IAAIH,EAAO,YAAcI,EAAEC,KAAKC,WAAW,gBAAiB,qBAAuB,gBAEnFR,EAASI,QAAQQ,QAAQ,SAASC,EAAQC,GACvC,IAAIC,EAAOF,EAAOG,UAAY,OAAS,OACnCC,EAAYJ,EAAOK,WAAWb,OAAS,EAAI,KAAOO,EAAOK,WAAWC,KAAK,MAAQ,GACjFC,EAAW,UAAYN,EAE3BZ,GAAQ,OACRA,GAAQ,eAAiBW,EAAOQ,IAAM,mBAAqBN,EAAOF,EAAOS,MAAQN,EAAY,OAEzFJ,EAAOG,WAAYQ,OAAOC,KAAKZ,EAAOa,WAAWpB,OAAS,IAC1DH,GAAQ,0EACJkB,EAAW,uDACV,KAAOf,EAAEC,KAAKC,WAAW,gBAAiB,qBAAuB,aACpEN,GAAQ,UAAYkB,EAAW,wFAChC,gFAAkF,cAGzFlB,GAAQ,OAERM,QAAQC,MAAMS,EAAQ,EAAI,KAAOD,EAAOS,OACxCf,QAAQE,IAAI,SAAUI,EAAOG,UAAY,eAAiB,cAC1DV,QAAQE,IAAI,MAAOI,EAAOQ,KACvBR,EAAOK,WAAWb,OAAS,GAC1BG,QAAQE,IAAI,aAAcI,EAAOK,YAElCL,EAAOG,YACHH,EAAOc,YACPnB,QAAQE,IAAI,cAAeI,EAAOc,YAElCJ,OAAOC,KAAKZ,EAAOa,WAAWpB,OAAS,EACvCG,QAAQE,IAAI,YAAaI,EAAOa,WAEhClB,QAAQE,IAAI,6BAGpBF,QAAQoB,aAGZpB,QAAQoB,WAEZ1B,GAAQ,QAERP,EAAWO,KAAKA,GAEhBV,EAAE,mBAAoBqC,GAAG,QAAS,SAASC,GAC3CA,EAAEC,iBACF,IAAIV,EAAW1B,EAAEoB,MAAMiB,KAAK,aACtBC,EAAevC,EAAE,IAAM0B,EAAW,eACpCP,EAASV,EAASI,QAAQuB,SAASb,EAASe,MAAM,KAAK,IAE3D,GAAID,EAAaE,GAAG,YAChBF,EAAaG,UACb1C,EAAEoB,MAAMuB,KAAK,IAAM/B,EAAEC,KAAKC,WAAW,gBAAiB,qBAAuB,UAC3E,CACH,IAAI8B,EAAgB,YAChBhC,EAAEC,KAAKC,WAAW,YAAa,qBAAuB,8BAE1D,IAAK,IAAI+B,IAAO1B,EAAOa,UACfb,EAAOa,UAAUc,eAAeD,KAChCD,GAAgB,iBACZC,EAAM,aAAe1B,EAAOa,UAAUa,GAAO,SAIzDD,GAAgB,QAChBL,EAAa5B,KAAK+B,GAClBL,EAAaS,YACZ9C,EAAEoB,MAAMuB,KAAK,IAAM/B,EAAEC,KAAKC,WAAW,iBAAkB,qBAAuB,WAItF,MAAO,SAAS,SAASkC,GACrB7C,EAAWO,KAAK,0CAA4CI,EAAEC,KAAKC,WAAW,eAAgB,qBAAuB,UACtHhB,EAAakD,UAAUD,GAC1BnC,QAAQmC,MAAM,gCAAiCA,WAI/D","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for loading LimeSurvey surveys.\n *\n * @module     block_limesurvey/surveys\n * @copyright  2024, Sergio\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    return {\n        init: function() {\n            this.loadSurveys();\n        },\n\n        loadSurveys: function() {\n            var contentDiv = $('#limesurvey-content');\n\n            Ajax.call([{\n                methodname: 'block_limesurvey_get_surveys',\n                args: {}\n            }])[0].done(function(response) {\n                if (!response.success) {\n                    contentDiv.html('<div class=\"alert alert-warning\">' + response.message + '</div>');\n                    return;\n                }\n\n                if (response.surveys.length === 0) {\n                    contentDiv.html('<p>' + M.util.get_string('nosurveys', 'block_limesurvey') + '</p>');\n                    return;\n                }\n\n                // Log all surveys data to console for debugging.\n                console.group('ðŸ“Š LimeSurvey - Survey Responses');\n                console.log('Total surveys:', response.surveys.length);\n\n                var html = '<strong>' + M.util.get_string('activesurveys', 'block_limesurvey') + '</strong><ul>';\n\n                response.surveys.forEach(function(survey, index) {\n                    var icon = survey.completed ? 'âœ… ' : 'â¬œï¸ ';\n                    var extraText = survey.attributes.length > 0 ? ', ' + survey.attributes.join(', ') : '';\n                    var surveyId = 'survey-' + index;\n\n                    html += '<li>';\n                    html += '<a href=\"' + survey.url + '\" target=\"_blank\">' +\n                            icon + survey.title + extraText + '</a>';\n\n                    // Add view responses button if completed.\n                    if (survey.completed && Object.keys(survey.responses).length > 0) {\n                        html += ' <button class=\"btn btn-sm btn-link view-responses\" data-survey-id=\"' +\n                                surveyId + '\" style=\"padding: 0; font-size: 0.9em;\">' +\n                                '[' + M.util.get_string('viewresponses', 'block_limesurvey') + ']</button>';\n                        html += '<div id=\"' + surveyId + '-responses\" class=\"survey-responses\" ' +\n                                'style=\"display: none; margin-top: 5px; padding: 10px; ' +\n                                'background: #f8f9fa; border-left: 3px solid #007bff; font-size: 0.9em;\"></div>';\n                    }\n\n                    html += '</li>';\n\n                    // Log survey details to console.\n                    console.group((index + 1) + '. ' + survey.title);\n                    console.log('Status:', survey.completed ? 'âœ… Completed' : 'â¬œï¸ Pending');\n                    console.log('URL:', survey.url);\n                    if (survey.attributes.length > 0) {\n                        console.log('Attributes:', survey.attributes);\n                    }\n                    if (survey.completed) {\n                        if (survey.responseid) {\n                            console.log('Response ID:', survey.responseid);\n                        }\n                        if (Object.keys(survey.responses).length > 0) {\n                            console.log('Responses:', survey.responses);\n                        } else {\n                            console.log('No response data available');\n                        }\n                    }\n                    console.groupEnd();\n                });\n\n                console.groupEnd();\n\n                html += '</ul>';\n                contentDiv.html(html);\n\n                // Attach click handlers for view responses buttons.\n                $('.view-responses').on('click', function(e) {\n                    e.preventDefault();\n                    var surveyId = $(this).data('survey-id');\n                    var responsesDiv = $('#' + surveyId + '-responses');\n                    var survey = response.surveys[parseInt(surveyId.split('-')[1])];\n\n                    if (responsesDiv.is(':visible')) {\n                        responsesDiv.slideUp();\n                        $(this).text('[' + M.util.get_string('viewresponses', 'block_limesurvey') + ']');\n                    } else {\n                        var responsesHtml = '<strong>' +\n                            M.util.get_string('responses', 'block_limesurvey') + ':</strong><ul style=\"margin: 5px 0;\">';\n\n                        for (var key in survey.responses) {\n                            if (survey.responses.hasOwnProperty(key)) {\n                                responsesHtml += '<li><strong>' + key + ':</strong> ' + survey.responses[key] + '</li>';\n                            }\n                        }\n\n                        responsesHtml += '</ul>';\n                        responsesDiv.html(responsesHtml);\n                        responsesDiv.slideDown();\n                        $(this).text('[' + M.util.get_string('hideresponses', 'block_limesurvey') + ']');\n                    }\n                });\n\n            }).fail(function(error) {\n                contentDiv.html('<div class=\"alert alert-danger\">' +\n                    M.util.get_string('error_loading', 'block_limesurvey') + '</div>');\n                Notification.exception(error);\n                console.error('Error loading LimeSurvey data:', error);\n            });\n        }\n    };\n});\n"]}
