define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){var e=function(d,e,f){console.log("ğŸš€ LimeSurvey block: Loading surveys..."),b.call([{methodname:"block_limesurvey_get_surveys",args:{}}])[0].done(function(b){if(console.log("âœ… LimeSurvey API response received:",b),!b.success)return void e.html('<div class="alert alert-warning">'+b.message+"</div>");if(0===b.surveys.length)return void e.html("<p>"+f.nosurveys+"</p>");console.group("ğŸ“Š LimeSurvey - Survey Responses"),console.log("Total surveys:",b.surveys.length);var c='<div style="display: flex; flex-direction: column; gap: 10px;">';b.surveys.forEach(function(a,b){var e=a.attributes.length>0?a.attributes.join(", "):"",g="survey-"+b;a.completed?(c+='<div style="padding: 12px 16px; border-radius: 8px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">',c+='<div style="display: flex; align-items: center; justify-content: space-between;">',c+='<div style="flex: 1;">',c+='<div style="font-weight: 600; color: #2e7d32; margin-bottom: 4px;"><span style="margin-right: 8px;">âœ“</span>'+a.title+"</div>",e&&(c+='<div style="font-size: 0.85em; color: #558b2f;">'+e+"</div>"),c+="</div>",c+='<span style="background: #4caf50; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75em; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Completed</span>',c+="</div>",Object.keys(a.responses).length>0&&(c+='<button class="btn btn-sm view-responses" data-survey-id="'+g+'" style="margin-top: 8px; padding: 6px 12px; background: white; border: 1px solid #4caf50; color: #4caf50; border-radius: 4px; font-size: 0.85em; cursor: pointer; transition: all 0.2s;">ğŸ“Š '+f.viewresponses+"</button>",c+='<div id="'+g+'-responses" class="survey-responses" style="display: none; margin-top: 8px; padding: 12px; background: white; border-radius: 4px; border: 1px solid #c8e6c9;"></div>'),c+="</div>"):(c+='<a href="'+a.url+'" target="_blank" style="text-decoration: none;">',c+='<div style="padding: 12px 16px; border-radius: 8px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.15)\'; this.style.transform=\'translateY(-2px)\';" onmouseout="this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.1)\'; this.style.transform=\'translateY(0)\';">',c+='<div style="display: flex; align-items: center; justify-content: space-between;">',c+='<div style="flex: 1;">',c+='<div style="font-weight: 600; color: #1565c0; margin-bottom: 4px;"><span style="margin-right: 8px;">â†’</span>'+a.title+"</div>",e&&(c+='<div style="font-size: 0.85em; color: #1976d2;">'+e+"</div>"),c+="</div>",c+='<span style="background: #2196f3; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75em; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Pending</span>',c+="</div>",c+="</div>",c+="</a>"),console.group(b+1+". "+a.title),console.log("Status:",a.completed?"âœ… Completed":"â¬œï¸ Pending"),console.log("URL:",a.url),a.attributes.length>0&&console.log("Attributes:",a.attributes),console.group("ğŸ” API Response Details"),console.log("Raw API Response:",a.raw_api_response),console.log("Decoded Data:",a.decoded_data),console.groupEnd(),a.completed&&(a.responseid&&console.log("Response ID:",a.responseid),Object.keys(a.responses).length>0?console.log("Responses:",a.responses):console.log("No response data available")),console.groupEnd()}),console.groupEnd(),c+="</div>",e.html(c),d(".view-responses").on("click",function(c){c.preventDefault();var e=d(this).data("survey-id"),g=d("#"+e+"-responses"),h=b.surveys[parseInt(e.split("-")[1])],i=d(this);if(g.is(":visible"))g.slideUp(),i.html("ğŸ“Š "+f.viewresponses);else{var j='<div style="font-weight: 600; color: #2e7d32; margin-bottom: 8px;">'+f.responses+':</div>';j+='<div style="display: grid; gap: 8px;">';for(var k in h.responses)h.responses.hasOwnProperty(k)&&(j+='<div style="padding: 8px; background: #f1f8e9; border-radius: 4px; border-left: 3px solid #4caf50;">',j+='<div style="font-size: 0.8em; color: #558b2f; margin-bottom: 2px;">'+k+"</div>",j+='<div style="color: #2e7d32; font-weight: 500;">'+h.responses[k]+"</div>",j+="</div>");j+="</div>",g.html(j),g.slideDown(),i.html("ğŸ“Š "+f.hideresponses)}})}).fail(function(a){e.html('<div class="alert alert-danger">'+f.error_loading+"</div>"),c.exception(a),console.error("âŒ Error loading LimeSurvey data:",a)})};return{init:function(){console.log("ğŸ¯ LimeSurvey block: Initializing..."),this.loadSurveys()},loadSurveys:function(){console.log("ğŸ“ Getting content div...");var b=a("#limesurvey-content");console.log("Content div found:",b.length>0);var c=[{key:"nosurveys",component:"block_limesurvey"},{key:"activesurveys",component:"block_limesurvey"},{key:"viewresponses",component:"block_limesurvey"},{key:"hideresponses",component:"block_limesurvey"},{key:"responses",component:"block_limesurvey"},{key:"error_loading",component:"block_limesurvey"}];console.log("ğŸ“ Loading language strings..."),d.get_strings(c).then(function(c){console.log("âœ… Language strings loaded:",c);var d={nosurveys:c[0],activesurveys:c[1],viewresponses:c[2],hideresponses:c[3],responses:c[4],error_loading:c[5]};e(a,b,d)}).catch(function(a){console.error("âŒ Error loading strings:",a),b.html('<div class="alert alert-danger">Error loading language strings</div>')})}}});
